<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고려대학교 포털</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        @font-face {
            font-family: 'Pretendard';
            src: local('Pretendard'), local('Pretendard-Regular'), local('Pretendard Regular');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Pretendard';
            src: local('Pretendard-Bold'), local('Pretendard Bold'), local('PretendardBold');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
        
        body, html {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
        
        button, input, textarea, select, a, span, div, p, h1, h2, h3, h4, h5, h6 {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
        
        .top-status-bar, .status-content, .session-info, .status-controls, .session-timer, .session-progress, .session-progress-fill, .login-settings-btn, .refresh-btn, .home-btn {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
        
        .modal, .modal-content, .modal-header, .modal-body, .modal-footer, .btn, .form-group, label, input, textarea, select {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
    </style>
    
    <script>
      // 웹뷰에 Pretendard 폰트 강력 주입 (모든 요소 적용)
      document.addEventListener('DOMContentLoaded', function() {
        const webview = document.getElementById('portal-webview');
        
        webview.addEventListener('dom-ready', function() {
          // 웹뷰 내부에 Pretendard 폰트 CSS 강력 주입
          webview.executeJavaScript(`
            (function() {
              console.log('웹뷰 내부 Pretendard 폰트 강력 주입 시작...');
              
              // 폰트 CSS 강력 주입 (Variable 폰트 방식)
              const fontCSS = \`
                @font-face {
                  font-family: 'Pretendard';
                  src: url('./fonts/Pretendard-Regular.woff2') format('woff2');
                  font-weight: 100 900;
                  font-style: normal;
                  font-display: swap;
                }
                @font-face {
                  font-family: 'Pretendard';
                  src: url('./fonts/Pretendard-Bold.woff2') format('woff2');
                  font-weight: 700;
                  font-style: normal;
                  font-display: swap;
                }
                
                /* 모든 요소에 강제 적용 */
                html, body, * {
                  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  font-display: swap !important;
                }
                
                /* 모든 텍스트 요소 강제 적용 */
                *, *::before, *::after {
                  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  font-display: swap !important;
                }
                
                /* 바탕체 관련 클래스 강제 제거 */
                .batang, .batang *, [class*="batang"], [class*="Batang"], 
                .gulim, .gulim *, [class*="gulim"], [class*="Gulim"],
                [class*="batang"], [class*="Batang"], [class*="gulim"], [class*="Gulim"] {
                  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  font-display: swap !important;
                }
                
                /* 인라인 스타일 무시 */
                [style*="font-family"], [style*="fontFamily"] {
                  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  font-display: swap !important;
                }
                
                /* CSS 변수 재정의 */
                :root {
                  --font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  --font-display: swap !important;
                }
                
                /* 모든 가능한 폰트 관련 속성 강제 적용 */
                [style*="font"], [style*="Font"] {
                  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
                  font-display: swap !important;
                }
              \`;
              
              // 기존 스타일 제거
              const existingStyles = document.querySelectorAll('#pretendard-font-injection, #pretendard-force-style');
              existingStyles.forEach(style => style.remove());
              
              const style = document.createElement('style');
              style.id = 'pretendard-font-injection';
              style.textContent = fontCSS;
              document.head.appendChild(style);
              
              // 모든 요소에 직접 스타일 강제 적용
              function applyFontToAllElements() {
                try {
                  const allElements = document.querySelectorAll('*');
                  allElements.forEach(element => {
                    if (element.style) {
                      element.style.setProperty('font-family', 'Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif', 'important');
                      element.style.setProperty('font-display', 'swap', 'important');
                    }
                  });
                  console.log('모든 요소에 Pretendard 폰트 적용 완료');
                } catch (error) {
                  console.warn('요소별 폰트 적용 오류:', error);
                }
              }
              
              // 즉시 적용
              applyFontToAllElements();
              
              // 주기적으로 재적용 (2초마다, 10초간)
              let applyCount = 0;
              const intervalId = setInterval(() => {
                applyFontToAllElements();
                applyCount++;
                if (applyCount >= 5) {
                  clearInterval(intervalId);
                  console.log('Pretendard 폰트 주기적 적용 완료');
                }
              }, 2000);
              
              // MutationObserver로 동적 콘텐츠 처리
              const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                    mutation.addedNodes.forEach((node) => {
                      if (node.nodeType === 1) { // Element node
                        if (node.style) {
                          node.style.setProperty('font-family', 'Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif', 'important');
                          node.style.setProperty('font-display', 'swap', 'important');
                        }
                        // 자식 요소들도 처리
                        const childElements = node.querySelectorAll('*');
                        childElements.forEach(element => {
                          if (element.style) {
                            element.style.setProperty('font-family', 'Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif', 'important');
                            element.style.setProperty('font-display', 'swap', 'important');
                          }
                        });
                      }
                    });
                  }
                });
              });
              
              // body가 준비되면 observer 시작
              if (document.body) {
                observer.observe(document.body, { 
                  childList: true, 
                  subtree: true,
                  attributes: true,
                  attributeFilter: ['style', 'class']
                });
              } else {
                document.addEventListener('DOMContentLoaded', () => {
                  observer.observe(document.body, { 
                    childList: true, 
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['style', 'class']
                  });
                });
              }
              
              // 페이지 로드 완료 후 한 번 더 적용
              window.addEventListener('load', () => {
                setTimeout(applyFontToAllElements, 1000);
              });
              
              console.log('Pretendard 폰트 강력 주입 완료');
            })();
          `);
        });
      });
    </script>
</head>
<body>
    <!-- 고정된 상단 상태 바 -->
    <div id="top-status-bar" class="top-status-bar">
        <div class="status-content">
            <div class="app-logo">
                <img src="./images/logo3.png" alt="고려대학교 로고" class="ku-logo-small">
                <img src="./images/emblem4.png" alt="고려대학교 엠블럼" class="ku-emblem-small">
            </div>
            <div class="session-info">
                <span id="session-timer" class="session-timer">세션: 30:00</span>
                <div class="session-progress">
                    <div id="session-progress-bar" class="session-progress-fill"></div>
                </div>
            </div>
            <div class="status-controls">
                <button id="login-settings-btn" class="login-settings-btn">
                    🔐 로그인 설정
                </button>
                <button id="refresh-btn" class="refresh-btn">새로고침</button>
                <button id="home-btn" class="home-btn">홈으로</button>
                <button id="update-btn" class="update-btn">
                    🔄 업데이트
                </button>
            </div>
        </div>
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <div id="main-content" class="main-content">
        <!-- 웹뷰 컨테이너 -->
        <div id="webview-container" class="webview-container">
            <webview id="portal-webview" src="https://portal.korea.ac.kr/front/Main.kpd"
                     class="portal-webview" 
                     webpreferences="contextIsolation=yes,nodeIntegration=no"
                     disablewebsecurity="true" 
                     allowpopups="false"></webview>
        </div>
    </div>

    <!-- 세션 만료 경고 모달 -->
    <div id="session-warning-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>세션 만료 경고</h3>
            </div>
            <div class="modal-body">
                <p>세션이 곧 만료됩니다. 계속 사용하시겠습니까?</p>
                <div class="countdown" id="countdown">5:00</div>
            </div>
            <div class="modal-footer">
                <button id="extend-session-btn" class="btn btn-primary">세션 연장</button>
                <button id="close-modal-btn" class="btn btn-secondary">닫기</button>
            </div>
        </div>
    </div>

    <!-- 로그인 설정 모달 -->
    <div id="login-settings-modal" class="modal hidden">
        <div class="modal-content setup-modal">
            <div class="modal-header">
                <div class="logo-container">
                    <img src="./images/logo3.png" alt="고려대학교 로고" class="ku-logo">
                    <img src="./images/emblem4.png" alt="고려대학교 엠블럼" class="ku-emblem">
                </div>
                <div class="slogan-container">
                    <img src="./images/kuni120-1.png" alt="고려대학교 슬로건" class="ku-slogan">
                </div>
            </div>
            <div class="modal-body">
                <form id="login-settings-form" class="setup-form">
                    <div class="form-group">
                        <label for="username">아이디</label>
                        <input type="text" id="username" name="username" placeholder="고려대학교 아이디" required>
                    </div>
                    <div class="form-group">
                        <label for="password">비밀번호</label>
                        <input type="password" id="password" name="password" placeholder="비밀번호" required>
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="auto-login" name="autoLogin">
                            <span>자동 로그인</span>
                        </label>
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="remember-credentials" name="rememberCredentials">
                            <span>로그인 정보 저장</span>
                        </label>
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="auto-update" name="autoUpdate">
                            <span>자동 업데이트</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer form-actions">
                <button id="save-login-settings-btn" class="btn btn-primary">저장</button>
                <button id="clear-login-settings-btn" class="btn btn-danger">정보 삭제</button>
                <button id="close-login-settings-btn" class="btn btn-secondary">닫기</button>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>
